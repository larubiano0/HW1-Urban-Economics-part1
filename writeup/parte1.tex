\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\usepackage{url}
\usepackage{hyperref}
\usepackage{float}
\usepackage{moresize}
\usepackage{booktabs}
\usepackage[para,online,flushleft]{threeparttable}


\makeatletter
\newcommand{\linebreakand}{%
  \end{@IEEEauthorhalign}
  \hfill\mbox{}\par
  \mbox{}\hfill\begin{@IEEEauthorhalign}
}
\makeatother



\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{\textit{Cook County, IL:} Índices de precios de viviendas}

\author{%
\IEEEauthorblockN{Luis Alejandro Rubiano Guerrero}
\IEEEauthorblockA{202013482\\
\href{mailto:la.rubiano@uniandes.edu.co}{\texttt{la.rubiano@uniandes.edu.co}}}
\and
\IEEEauthorblockN{Andres Felipe Rosas Castillo}
\IEEEauthorblockA{202013471\\
\href{mailto:a.rosasc@uniandes.edu.co}{\texttt{a.rosasc@uniandes.edu.co}}}
\and
\IEEEauthorblockN{Carlos Andrés Castillo Cabrera}
\IEEEauthorblockA{202116837\\
\href{mailto:ca.castilloc1@uniandes.edu.co}{\texttt{ca.castilloc1@uniandes.edu.co}}}
}



\maketitle


\section{Introducción}

A través de este informe se construyen y se comparan \textbf{cuatro índices de precios de vivienda} para 
\textit{Cook County, Illinois} para el periodo comprendido entre 2000 y 2020. Las metodologías correspondientes a 
cada uno de los índices son las siguientes: (i) y (ii) índices de precios hedónicos, (iii) Índice de precios de la vivienda usada (IPVU), 
y (iv) estimador de efectos fijos con errores agrupados a nivel de propiedad. El objetivo de este informe es comparar y contrastar
 los resultados obtenidos a través de cada una de las metodologías, así como discutir las ventajas y desventajas de cada una de ellas.

En la sección II. se describe el conjunto de datos utilizado, así como el proceso de limpieza y tratamiento de los datos.
  La sección III. detalla la metodología utilizada para cada uno de los índices. En la sección IV. se presentan los resultados obtenidos, 
  así como un análisis comparativo entre los diferentes índices. Finalmente, en la sección V. se presentan las conclusiones del informe 
  y en la sección VI. se proporciona información adicional para la reproducibilidad del análisis.

\section{Datos y preparación}

\subsection{Descripción del conjunto de datos}

El conjunto de datos utilizado en este informe es \texttt{dataTaller01\_PriceIndeces.Rds}, 
el cual contiene información sobre ventas de viviendas en \textit{Cook County, Illinois} entre los años 2000 y 2020.
En total, el conjunto de datos contiene $427.649$ observaciones y $31$ variables. Estas variables incluyen 
el \texttt{pin} (identificador único de la propiedad), \texttt{year} (fecha de venta de la vivienda),
  \texttt{sale\_price} (precio de venta de la vivienda), \texttt{township\_code} (código local correspondiente al \textit{township} donde se ubica la propiedad),
  así como 27 covariables continuas y categóricas de características estructurales y de ubicación de las viviendas.

\subsection{Limpieza y tratamiento}

Se encontraron valores faltantes para $1060$ de las observaciones, en las variables 
\texttt{building\_sqft}, \texttt{num\_bedrooms}, \texttt{num\_rooms}, \texttt{num\_full\_baths},
\texttt{num\_half\_baths} y \texttt{num\_fireplaces}. Estas observaciones fueron eliminadas del conjunto de datos.

Adicionalmente, después de eliminar las anteriores observaciones, se encontraron $151.929$ observaciones con 
valores faltantes en la variable \texttt{land\_sqft}, lo cual representa aproximadamente el $36\%$ del total de las observaciones.
Estas fueron tratadas de manera diferente dependiendo de la metodología utilizada para construir los índices de precios de vivienda.

Adicionalmente se creó la variable \texttt{log\_sale\_price}, la cual corresponde al logaritmo natural del precio de venta de la vivienda, la 
cual es la variable dependiente de interés en los respectivos índices de precios.

\section{Metodología}

En todas las metodologías se normaliza el índice tomando como base el año 2000, es decir, el índice toma valor 100 en el año 2000.

\subsection{Índice hedónico}

Un índice hedónico se encuentra definido por la siguiente regresión.

\[ \log(P)_{it} = \sum_{t=t_0}^{T} \delta_t D_{it} + \sum_{j=1}^h \beta_j H_{ij} + \sum_{k=1}^n \beta_k N_{ik} + \mu_{it} \]

En donde:

\begin{itemize}
  \item $\log{P}_{it}$ es el logaritmo natural del precio de venta de la vivienda $i$ en el tiempo $t$, ($t = t_0, \ldots, T$).
  \item $D_{it}$ es una variable indicadora de la venta de la vivienda $i$ en el tiempo $t$.
  \item $H$ representa características estructurales de la vivienda.
  \item $N$ representa características de la ubicación de la vivienda.
  \item $\mu_{it}$ es el término de error, el cual se asume que es idénticamente distribuido, $\mu_{it} \sim N(0, \sigma^2)$.
\end{itemize}

En este caso estimamos dos índices hedónicos diferentes, en donde $t_0 = 2000$ y $T = 2020$. 

En el primer modelo las características estructurales $H$ son:

\texttt{class, year\_built, building\_sqft, land\_sqft, num\_bedrooms, num\_rooms, num\_full\_baths, num\_half\_baths, num\_fireplaces,
type\_of\_residence, construction\_quality, attic\_finish, garage\_attached, garage\_area\_included, garage\_size, garage\_ext\_wall\_material, attic\_type, basement\_type, ext\_wall\_material, central\_heating, basement\_finish, roof\_material, renovation, recent\_renovation, porch, central\_air}

y en el segundo modelo son las mismas características estructurales pero sin incluir \texttt{land\_sqft}.

en ambos modelos las características de ubicación $N$ son:

\texttt{township\_code, site\_desirability}. 

La diferencia entre los modelos es que en el primero se incluye la covariable 
\texttt{land\_sqft}, pero se eliminan las observaciones con valores faltantes en esta variable,
mientras que en el segundo modelo no se incluye esta covariable, pero se utilizan todas las observaciones.

Asimismo, de manera preventiva se agrupan los errores a nivel de \texttt{township\_code}, es decir, se asume que los errores pueden estar correlacionados 
dentro de cada \textit{township}, pero son independientes entre diferentes \textit{townships}.

Finalmente, para estimar los índices se calcula $I_t = 100 \cdot \exp(\beta_t - \beta_{2000}) = 100 \cdot \exp(\beta_t)$, y se calculan sus errores estándar utilizando el método del delta, 
es decir $\text{var}(I_t) \approx (100 \cdot \exp(\beta_t)) \cdot \text{var}(\beta_t)$.


\subsection{Índice de ventas repetidas (IPVU)}

En este índice requiere identificar viviendas que hayan sido vendidas por lo
menos dos veces dentro del periodo de estudio, basado en la metodología de \textit{Case y Shiller} (1989).

Por lo tanto, filtramos el conjunto de datos para incluir únicamente aquellas viviendas que han sido vendidas más de una vez
durante el periodo de estudio y que no hayan presentado modificaciones significativas en
su estructura física. Para lo último, descartamos las ventas tales que la variable \texttt{recent\_renovation} sea \texttt{TRUE}. 
La base de datos resultante tiene $233.233$ observaciones. 

En este modelo se asume que el comportamiento del precio de la misma vivienda
$P_t$ es un proceso estocástico dado por:

\[ \ln(P_{i,t}) = \beta_t + H_{i,t} + N_{i, t}\] 

En donde $\beta_t$ corresponde al índice del precio, $H_{i, t}$ es una caminata aleatoria
gaussiana que describe como el cambio del precio de una vivienda individual se desvía en
el tiempo respecto a la variación del índice de mercado, y $N_{i, t}$ son errores que se asumen 
normales y representa las diferencias idiosincrásicas de las propiedades en un momento
del tiempo.

Para este índice se crea una variable que representa el cambio porcentual total en el precio de una vivienda entre dos transacciones. Esta variable se define como:

\begin{align*}
  \Delta V_i &= \ln(P_{i,t})-\ln(P_{i,s})\\
  &= \beta_t - \beta_s + H_{i,t} - H_{i,s} + N_{i,t} - N_{i,s}\\
\end{align*}

Sobre los términos de perturbación se asume que 

\begin{align*}
  \mathbb{E}[H_{i,t} - H_{i, s}] &= 0 (\text{media cero}) \\
  \text{Var}(H_{i,t} - H_{i, s}) &= A(t-s) + B(t-s)^2 (\tiny\text{var cuadrática en el tiempo})\\
  \mathbb{E}[N_{i, t}] &= 0 (\text{media cero})\\
  \text{Var}(N_{i, t}) &= c (\text{varianza constante})\\
  \mathbb{E}[H_{i,t}N_{i, t}] &= 0 (\text{independencia})
\end{align*}

Partiendo de lo anterior, los índices de precios se estiman en tres etapas:

\begin{enumerate}
  \item Primera etapa: Se estiman los $\beta$ iniciales y los errores.
  
  Para una venta repetida de una vivienda $i$ se estima el cambio porcentual de la siguiente forma:

  \begin{align*}
    \Delta V_i &= \sum_{t=t_0}^{T} \ln(P_{i,t}) D_{it}\\
    &= \sum_{t=t_0}^{T} \beta_t D_{it} + \varepsilon_{i}
  \end{align*}

  En donde $D_{it}$ es una variable indicadora que toma valor 
  $1$ cuando el precio de la vivienda $i$ es
  observado por segunda vez en $t$, $-1$ si el precio de la vivienda $i$ fue observado por primera
  vez en $t$, y cero de lo contrario. 

  Aquí $\beta_t$ se estima a través de mínimos cuadrados ordinarios.

  \item Segunda etapa: Se estima la varianza de la caminata aleatoria.
  
  En esta etapa se estiman los coeficientes $A$, $B$ y $c$ a través de mínimos cuadrados ordinarios,
  mediante la expresión:

  \[ \mathbb{E}[\varepsilon_i^2] = A(t-s) + B(t-s)^2 + c \]

  Es decir, se estima la varianza de los errores al cuadrado como función cuadrática del tiempo entre ventas.
  En este caso $\mathbb{E}[\varepsilon_i^2]$ es la varianza muestral de los errores estimados en la primera etapa.
  Si los coeficientes estimados $A$ y $B$ son positivos y significativos, se debe continuar con la tercera etapa, 
  en tal caso la raíz cuadrada de los valores estimados por la ecuación se utiliza para ponderar por mínimos cuadrados generalizados.

  \item Tercera etapa: Se re-estiman los $\beta$ utilizando mínimos cuadrados generalizados.
  
  Es decir, se estima 

  \[ \cfrac{\Delta V_i}{\sqrt{\hat{\varepsilon_i^2}}} = \sum_{t=t_0}^{T} \cfrac{\beta_t}{\sqrt{\hat{\varepsilon_i^2}}} D_{it} + \cfrac{\varepsilon_{i}}{\sqrt{\hat{\varepsilon_i^2}}} \]

  Posteriormente, los indices y los errores estándar se calculan de forma similar a la metodología de índices hedónicos.

\end{enumerate}


\subsection{Estimador de efectos fijos con errores agrupados}

El estimador de efectos fijos (FE) explota la variación \emph{intra-propiedad} para aislar cambios en el precio no explicados por características inobservables \emph{invariantes en el tiempo} de cada vivienda. 
Para esto se filtraron las propiedades con al menos dos ventas en el periodo de estudio, resultando en $233.388$ observaciones.

La especificación es:

\[ \log(P)_{it} = \sum_{t=t_0}^{T} \delta_t D_{it} + \sum_{j=1}^h \beta_j Z_{ij} + \alpha_i + \epsilon_{it} \]

En donde:

\begin{itemize}
  \item $D_{it}$ es una variable indicadora de la venta de la vivienda $i$ en el tiempo $t$.
  \item $Z$ representa características estructurales y de ubicación de la vivienda que varían en el tiempo, en particular 
  \texttt{building\_sqft, num\_bedrooms, num\_rooms, num\_full\_baths, num\_half\_baths, renovation, recent\_renovation, central\_air, central\_heating, garage\_attached, garage\_size, attic\_finish, basement\_finish}.
  \item $\alpha_i$ es el efecto fijo de la vivienda $i$.
  \item $\epsilon_{it}$ es el término de error, el cual se asume que es idénticamente distribuido, $\epsilon_{it} \sim N(0, \sigma^2)$.
\end{itemize}

En este caso asumimos que los errores pueden estar correlacionados dentro de cada propiedad a lo largo del tiempo, pero son independientes entre diferentes propiedades, y por lo tanto 
agrupamos los errores a nivel de propiedad.

Aquí los índices y los errores estándar se calculan de forma similar a la metodología de índices hedónicos.

\section{Resultados y análisis}

\end{document}
